#
# MultiQC Configuration for Hybrid Assembly Pipeline
#
# This configuration customizes the MultiQC report for bacterial
# hybrid genome assembly using Illumina and Nanopore data
#

# Report metadata
title: "Hybrid Assembly QC Report"
subtitle: "Illumina + Nanopore Bacterial Genome Assembly"
intro_text: |
    This report aggregates quality control metrics from all steps of the
    hybrid bacterial genome assembly pipeline.

    **Pipeline Workflow:**

    1. **Illumina QC** (fastp) - Adapter trimming and quality filtering
    2. **Nanopore QC** (Porechop ABI, Filtlong) - Adapter removal and quality filtering
    3. **Assembly** (Unicycler, optionally with Flye) - Hybrid genome assembly
    4. **Assembly QC** (CheckM2, QUAST) - Completeness and quality assessment

    **Key Metrics to Review:**

    - **Read Quality**: Check fastp results for adapter content and quality scores
    - **Assembly Contiguity**: Review QUAST N50 and number of contigs
    - **Assembly Completeness**: Check CheckM2 completeness and contamination scores

    For detailed documentation, see: https://github.com/yourusername/listeria-hybrid-nf

# Report customization
report_comment: |
    Generated by listeria-hybrid-nf pipeline.
    For issues or questions, see: https://github.com/yourusername/listeria-hybrid-nf/issues

# Report sections order
# Control the order in which report sections appear
report_section_order:
    # Software versions at the end
    software_versions:
        order: -1000
    # Workflow summary at the very end
    workflow_summary:
        order: -1001

# Module search patterns
# Tell MultiQC where to find output files from each tool
sp:
    # fastp - Illumina read QC
    fastp:
        fn: '*.json'

    # QUAST - Assembly statistics
    quast:
        fn: 'report.tsv'

    # TODO: Add patterns for additional tools in Phase 2+
    # CheckM2, Filtlong, Porechop logs may need custom parsing

    # Example custom log patterns (uncomment and adjust as needed):
    # porechop_abi:
    #     fn: '*.log'
    #     contents: 'Porechop'
    # filtlong:
    #     fn: '*.log'
    #     contents: 'Filtlong'

# Table column configuration
# Control which columns are visible in summary tables
table_columns_visible:
    fastp:
        # Hide less important columns
        pct_duplication: False
        pct_gc: True

    quast:
        # Show most important assembly metrics
        'Total length': True
        'N50': True
        'L50': True
        '# contigs': True
        'Largest contig': True
        'GC (%)': True

        # Hide less critical metrics
        'N75': False
        'L75': False

# Table column ordering
# Define custom order for table columns
table_columns_placement:
    fastp:
        pct_surviving: 1
        pct_duplication: 2

    quast:
        '# contigs': 1
        'Largest contig': 2
        'Total length': 3
        'N50': 4
        'L50': 5

# Sample name cleaning
# Clean up sample names for better display
# Format: 'search_pattern': 'replacement' (empty string to remove)
sample_names_replace:
    '_trimmed': ''
    '_porechop': ''
    '_filtlong': ''
    '_unicycler': ''
    '_flye': ''

# Configure specific modules
# Customize behavior of individual MultiQC modules

# fastp module settings
fastp:
    read_count_multiplier: 0.001  # Convert read counts to thousands (K)
    read_count_prefix: 'K'
    read_count_desc: 'thousands'

# QUAST module settings
quast:
    contig_length_multiplier: 0.001  # Convert to Kb
    contig_length_prefix: 'K'
    contig_length_suffix: 'bp'

# General statistics table
# Customize the main statistics table shown at the top of the report
table_cond_formatting_rules:
    # Assembly metrics thresholds (customize based on your expectations)

    # Completeness (if CheckM2 data is available)
    completeness:
        pass:
            - gt: 95
        warn:
            - lt: 95
        fail:
            - lt: 80

    # Contamination (if CheckM2 data is available)
    contamination:
        pass:
            - lt: 2
        warn:
            - gt: 2
        fail:
            - gt: 5

    # Number of contigs (fewer is better for bacterial genomes)
    '# contigs':
        pass:
            - lt: 50
        warn:
            - gt: 50
        fail:
            - gt: 200

    # N50 (larger is better - in Kb for bacterial genomes)
    N50:
        pass:
            - gt: 100000  # >100 Kb
        warn:
            - lt: 100000
        fail:
            - lt: 10000   # <10 Kb

# Custom data configuration
# TODO: Add custom data parsing in Phase 2+ if needed
# This section can be used to parse log files and add custom metrics
# custom_data:
#     filtlong_stats:
#         file_format: 'txt'
#         section_name: 'Filtlong Statistics'
#         description: 'Nanopore read filtering statistics'
#         plot_type: 'bargraph'

# Export plots
# Save individual plots as files
export_plots: true

# Remove empty sections
# Hide sections with no data
remove_sections:
    - fastqc_sequence_duplication_levels
    - fastqc_status_checks

# Report styling (optional)
# Uncomment to customize report appearance
# custom_logo: 'path/to/logo.png'
# custom_logo_url: 'https://your-institution.edu'
# custom_logo_title: 'Your Institution'

# Disable certain features if needed
# disable_version_detection: false
# no_version_check: false

# Data output
# Make the raw data available in the report
make_data_dir: true
zip_data_dir: true

# Filename patterns to ignore
# These files will be skipped by MultiQC
fn_ignore_files:
    - '.command.*'
    - '*.bam'
    - '*.bai'
    - '*.sam'
    - 'work/**'
    - '.nextflow/**'

# Directory patterns to ignore
fn_ignore_dirs:
    - 'work'
    - '.nextflow'
    - 'singularity_cache'
    - '.git'

# Report verbosity
# Set to 'quiet' to reduce log output
# Options: 'quiet', 'normal', 'verbose', 'debug'
log_filesize_limit: 10000000  # 10MB
