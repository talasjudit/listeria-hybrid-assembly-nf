/*
========================================================================================
    Local Executor Configuration
========================================================================================
    Configuration for running the pipeline on a local workstation or server

    This profile is suitable for:
    - Testing and development
    - Small datasets on powerful workstations
    - Single-node servers

    Important Notes:
    - All processes run sequentially or with limited parallelism (controlled by maxForks)
    - Total resource usage is controlled by params.max_cpus and params.max_memory
    - Not recommended for large production runs (use SLURM profile instead)

    Usage:
      nextflow run main.nf -profile local,singularity --input samplesheet.csv
========================================================================================
*/

process {
    executor = 'local'

    /*
     * Limit Concurrent Processes
     * Controls how many processes can run simultaneously
     *
     * maxForks = 1 : Fully sequential execution (one process at a time)
     * maxForks = 2 : Up to 2 processes can run concurrently
     * maxForks = 4 : Up to 4 processes can run concurrently (default)
     *
     * Note: Even with maxForks > 1, Nextflow respects max_cpus and max_memory
     * from params, so total resource usage won't exceed your limits
     */
    maxForks = 4

    /*
     * Error Strategy
     * For local execution, it's often better to fail fast
     * This can be overridden on a per-process basis in base.config
     */
    errorStrategy = 'finish'

    /*
     * Working Directory
     * By default, Nextflow uses ./work in the project directory
     * Uncomment to specify a different location (e.g., faster storage)
     */
    // workDir = '/path/to/fast/scratch/space/work'
}

/*
========================================================================================
    EXECUTOR SETTINGS
========================================================================================
*/

executor {
    /*
     * Local Executor Resource Limits
     * These should match your system capabilities
     * They're initialized from params but can be overridden here
     *
     * To check your system resources:
     * - CPUs: nproc (Linux) or sysctl -n hw.ncpu (macOS)
     * - Memory: free -h (Linux) or sysctl hw.memsize (macOS)
     */
    cpus   = params.max_cpus
    memory = params.max_memory

    /*
     * For local execution, these are less relevant but can be set
     */
    // queueSize = 1  // Only relevant if using maxForks > 1
}

/*
========================================================================================
    SINGULARITY SETTINGS
========================================================================================
*/

singularity {
    enabled     = true
    autoMounts  = true
    cacheDir    = params.singularity_cachedir

    /*
     * For local execution, you may want to bind mount additional directories
     * Example: If your data is on an external drive
     */
    // runOptions = '--bind /mnt/data:/data'

    /*
     * On macOS or systems with limited /tmp space, you may want to set TMPDIR
     */
    // envWhitelist = 'TMPDIR'
}
/*
    Notes:
    - Set max_cpus and max_memory conservatively for your system
    - Use SSD storage for work directory if possible
    - Use -resume to restart failed runs
*/
